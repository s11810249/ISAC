<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>東海大學實習業務協作平台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // === 修改：使用 CSS 變數以同步後台設定 ===
                        thuBlue: 'var(--color-thu)',       // 對應 id: thu
                        thuLightBlue: '#eef6fc',           // 固定淺色底
                        thuGold: 'var(--color-glorygold)', // 對應 id: glorygold
                        
                        // 自定義顏色映射 (對應 data.json 中的 id)
                        lapisYellow: 'var(--color-lapisyellow)',
                        concreteGrey: 'var(--color-concretegrey)',
                        brickRed: 'var(--color-brickred)',
                        windowBlack: 'var(--color-windowblack)',
                        acaciaGreen: 'var(--color-acaciagreen)',
                        milkWhite: 'var(--color-milkwhite)',
                        lakeBlue: 'var(--color-lakeblue)',
                        phoenixOrange: 'var(--color-phoenixorange)',
                        thuBlueNew: 'var(--color-thubluenew)',
                        gloryGold: 'var(--color-glorygold)',
                        grassGreen: 'var(--color-grassgreen)',
                    },
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* 定義預設顏色變數 (防止 JS 載入失敗時的備案) */
        :root {
            --color-thu: #002E5D;
            --color-glorygold: #C6A87C;
            --color-lapisyellow: #E89B00;
            --color-concretegrey: #A6A9AA;
            --color-brickred: #A14332;
            --color-windowblack: #2B2B2B;
            --color-acaciagreen: #4A6B3E;
            --color-milkwhite: #F4F1EA;
            --color-lakeblue: #365C68;
            --color-phoenixorange: #FF5A45;
            --color-thubluenew: #005596;
            --color-grassgreen: #219653;
        }

        /* 自定義樣式 */
        .hero-bg {
            background: linear-gradient(135deg, var(--color-thu) 0%, #001a35 100%);
            position: relative;
            overflow: hidden;
            min-height: 100vh; /* 確保填滿畫面 */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .hero-bg::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 30px 30px; z-index: 1;
        }
        .modal { transition: opacity 0.25s ease; }
        body.modal-active { overflow-y: hidden !important; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in-up { animation: fadeInUp 0.8s ease-out forwards; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #aaa; }

        /* 載入畫面樣式 */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #001a35; /* 深藍色背景 */
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            transition: opacity 0.5s ease-out;
        }

        .spinner {
            width: 80px;
            height: 80px;
            border: 6px solid #eef6fc; /* 輕量化底色 */
            border-top-color: var(--color-glorygold); /* 主色 */
            border-radius: 50%;
            animation: spin 1s linear infinite;
            position: relative;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #loading-percent {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.1rem;
            font-weight: bold;
            color: white;
            font-family: monospace;
        }
        
        /* 滾動箭頭動畫 */
        @keyframes bounce {
          0%, 20%, 50%, 80%, 100% {
            transform: translateY(0);
          }
          40% {
            transform: translateY(-10px);
          }
          60% {
            transform: translateY(-5px);
          }
        }
        .animate-scroll-down {
          animation: bounce 2s infinite;
        }
        
        /* 1. LOGO獨立陰影與發光效果 (平時的陰影) */
        #hero-logo {
            filter: drop-shadow(0 0 15px rgba(0, 0, 0, 1)) drop-shadow(0 0 3px rgba(255, 255, 255, 0.4)); 
            transition: all 0.3s ease-out;
        }
        
        /* 2. 標題與 LOGO hover 發光效果 */
        .title-group:hover #hero-logo {
             /* hover發光 */
             filter: drop-shadow(0 0 20px var(--color-glorygold)) drop-shadow(0 0 10px rgba(255, 255, 255, 0.8)); 
             transform: scale(1.05);
        }
        .title-group:hover #hero-title-1,
        .title-group:hover #hero-title-2,
        .title-group:hover #hero-eng-title {
            text-shadow: 0 0 4px #fff, 0 0 10px var(--color-glorygold);
            transform: scale(1.02);
            transition: text-shadow 0.3s ease-out, transform 0.3s ease-out;
        }
        
        /* 修正: 滾動按鈕的隱藏/顯示 */
        #scroll-to-top.hidden {
            opacity: 0;
            visibility: hidden;
        }
        #scroll-to-top.show {
            opacity: 1;
            visibility: visible;
        }
        
        /* 確保按鈕堆棧在 Footer 之上 */
        #action-stack {
            z-index: 100;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans text-gray-700 flex flex-col min-h-screen overflow-x-hidden">
    
    <div id="loading-overlay">
        <div class="relative w-20 h-20 mb-4">
            <div class="spinner"></div>
            <div id="loading-percent">0%</div>
        </div>
        <div class="text-white font-medium text-lg">載入中...</div>
    </div>

    <nav id="sticky-header" class="fixed top-0 left-0 w-full bg-thuBlue/95 backdrop-blur-sm shadow-lg z-40 transition-all duration-500 ease-in-out -translate-y-full opacity-0 flex items-center h-16 px-4 sm:px-8">
        <div class="w-full max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <img id="nav-logo" src="https://www.thu.edu.tw/upload/pagepic_upload/logo_w.svg" alt="Logo" class="h-6 sm:h-8 w-auto">
                <div class="text-white leading-none flex flex-col justify-center">
                    <span class="font-bold text-base sm:text-lg tracking-widest" id="nav-title">東海大學實習業務協作平台</span>
                </div>
            </div>
            <a href="https://www.thu.edu.tw/" target="_blank" class="flex items-center gap-2 text-white hover:text-thuGold transition-colors text-xs sm:text-sm font-medium whitespace-nowrap">
                <i class="fa-solid fa-house"></i> <span>東海首頁</span>
            </a>
        </div>
    </nav>

    <div class="hero-bg text-white relative">
        <div class="absolute top-4 right-4 sm:top-6 sm:right-6 z-30">
            <a href="https://www.thu.edu.tw/" target="_blank" class="flex items-center gap-2 px-3 py-1.5 sm:px-4 sm:py-2 bg-thuGold text-white border border-thuGold rounded-full hover:brightness-110 transition-all duration-300 font-bold backdrop-blur-sm shadow-md text-sm sm:text-base hover:shadow-lg hover:-translate-y-0.5">
                <i class="fa-solid fa-house"></i> 東海大學首頁
            </a>
        </div>
        
        <div class="absolute top-0 left-0 w-full h-full overflow-hidden z-0 pointer-events-none">
             <div class="absolute -top-20 -right-20 w-96 h-96 bg-thuGold opacity-10 rounded-full blur-3xl"></div>
             <div class="absolute top-40 -left-20 w-72 h-72 bg-blue-400 opacity-10 rounded-full blur-3xl"></div>
        </div>

        <div class="w-full max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10 text-center flex flex-col items-center justify-center pt-16 pb-24">
            
            <div class="title-group group flex flex-col items-center cursor-pointer animate-fade-in-up">
                <div class="logo-container mb-6 sm:mb-8">
                    <img id="hero-logo" src="https://www.thu.edu.tw/upload/pagepic_upload/logo_w.svg" alt="Logo" class="h-16 md:h-24 w-auto">
                </div>
                
                <div class="text-center mb-6 w-full" style="animation-delay: 0.2s;">
                    <h1 class="text-2xl sm:text-3xl md:text-5xl font-black tracking-wide md:tracking-widest leading-tight drop-shadow-xl mb-2 px-2">
                        <span id="hero-title-1" class="inline-block">實習業務</span><span class="text-thuGold inline-block" id="hero-title-2">協作平台</span>
                    </h1>
                    <p id="hero-eng-title" class="text-sm md:text-base text-blue-200 tracking-wide font-light opacity-90 px-4">Internship Coordination Platform</p>
                </div>
            </div>
            
            <p id="hero-subtitle" class="text-base sm:text-lg text-blue-100/90 font-light mb-8 sm:mb-10 max-w-3xl mx-auto leading-relaxed animate-fade-in-up px-4" style="animation-delay: 0.4s;">載入中...</p>
            
            <div class="flex flex-col sm:flex-row items-center justify-center gap-4 sm:gap-5 animate-fade-in-up w-full sm:w-auto px-4 sm:px-0" style="animation-delay: 0.6s;">
                <button onclick="toggleModal('origin-modal')" class="group relative px-6 sm:px-8 py-3.5 bg-thuGold hover:brightness-110 text-white font-bold rounded-full transition-all duration-300 shadow-lg hover:shadow-orange-500/20 hover:-translate-y-1 overflow-hidden w-full sm:w-60">
                    <div class="absolute inset-0 w-full h-full bg-white/20 group-hover:translate-x-full transition-transform duration-500 -skew-x-12 -ml-4"></div>
                    <span class="relative flex items-center justify-center gap-2 text-base sm:text-lg"><i class="fas fa-feather-alt"></i> <span>查看計畫緣起</span></span>
                </button>
                <a href="https://aca.thu.edu.tw/web/isac/page.php?scid=112&sid=103" target="_blank" class="px-6 sm:px-8 py-3.5 bg-white/5 hover:bg-white/10 text-white border border-white/20 backdrop-blur-sm font-medium rounded-full transition-all duration-300 hover:-translate-y-1 flex items-center justify-center gap-2 hover:border-white/40 w-full sm:w-60 text-base sm:text-lg">
                    <i class="fa-solid fa-link text-blue-300"></i> 實習中心網頁
                </a>
            </div>

            <div id="news-container" class="w-full max-w-3xl mx-auto bg-white/10 backdrop-blur-md rounded-xl border border-white/20 p-4 sm:p-5 text-left animate-fade-in-up hidden mt-8 mx-4" style="animation-delay: 0.8s;">
                <div class="flex items-center justify-between mb-3 pb-2 border-b border-white/10">
                    <div class="flex items-center gap-2">
                        <i class="fas fa-bullhorn text-thuGold animate-pulse"></i>
                        <span class="font-bold text-white text-base tracking-wide">最新公告</span>
                    </div>
                    <button id="view-more-news-btn" onclick="openAllNewsModal()" class="hidden text-xs bg-white/20 hover:bg-white/30 text-white px-3 py-1.5 rounded-full transition-colors flex items-center gap-1 border border-white/10">
                        查看所有 <i class="fas fa-chevron-right text-[10px]"></i>
                    </button>
                </div>
                <ul id="news-list" class="space-y-3 text-sm text-blue-50">
                    <li class="text-center py-2 text-gray-300">讀取公告中...</li>
                </ul>
            </div>
            
            <div id="scroll-arrow-target" class="absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white/50 hover:text-white transition cursor-pointer p-3 z-20 animate-scroll-down hidden md:block" style="bottom: 1vh;" onclick="customScrollToMain()">
                <i class="fas fa-chevron-down text-3xl"></i>
            </div>
        </div>
    </div>

    <main id="main-content" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-10 pb-20 flex-grow w-full">
        <div id="cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8">
             <div class="col-span-full text-center text-gray-500 p-10 bg-white rounded-xl shadow-lg">讀取中...</div>
        </div>
    </main>

    <footer id="footer-trigger" class="fixed bottom-0 left-0 w-full z-50 bg-gray-800 text-gray-400 py-3 text-center text-xs border-t-3 border-thuGold hidden">
        <div class="container mx-auto px-4">
            <div class="flex flex-col items-center justify-center gap-1">
                <p id="footer-copyright" class="font-bold text-white tracking-wide text-[10px]"></p>
                <p class="text-[9px] text-gray-500">網頁製作：張博堯 | Assisted by Google Gemini | <a href="admin.html" target="_blank" class="hover:text-white">後台管理</a></p>
            </div>
        </div>
    </footer>

    <div id="action-stack" class="fixed bottom-20 sm:bottom-8 right-4 sm:right-8 z-50 flex flex-col items-end gap-2">
        
        <button id="scroll-to-top" onclick="scrollToTop()" class="w-10 h-10 sm:w-12 sm:h-12 bg-thuGold text-white rounded-full shadow-lg hover:bg-yellow-700 transition-all duration-300 hidden md:flex items-center justify-center z-50">
            <i class="fas fa-chevron-up text-lg sm:text-xl"></i>
        </button>

        <div class="flex flex-col items-end z-50">
            <div class="bg-white text-gray-800 px-3 py-1.5 sm:px-4 sm:py-2 rounded-2xl shadow-lg border border-gray-100 text-xs sm:text-sm font-bold mb-2 animate-bounce origin-bottom-right relative cursor-pointer" onclick="toggleModal('contact-modal')">
                需要協助嗎？
                <div class="absolute -bottom-1.5 right-6 w-3 h-3 bg-white transform rotate-45 border-r border-b border-gray-100"></div>
            </div>
            <button onclick="toggleModal('contact-modal')" class="w-12 h-12 sm:w-14 sm:h-14 bg-thuBlue hover:bg-blue-800 text-white rounded-full shadow-2xl flex items-center justify-center transition-all duration-300 hover:scale-110 hover:rotate-12 group focus:outline-none focus:ring-4 focus:ring-blue-300 border-2 border-white">
                <i class="fas fa-headset text-xl sm:text-2xl group-hover:animate-pulse"></i>
            </button>
        </div>
    </div>


    <div id="origin-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-[100]">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50" onclick="toggleModal('origin-modal')"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-2xl mx-auto rounded-xl shadow-2xl z-50 overflow-y-auto max-h-[90vh]">
            <div class="flex justify-between items-center py-4 px-6 border-b border-gray-200 sticky top-0 bg-white">
                <div class="flex items-center gap-2"><i class="fas fa-feather-alt text-thuGold text-xl"></i><p class="text-xl sm:text-2xl font-bold text-thuBlue" id="modal-origin-title">計畫緣起</p></div>
                <div class="cursor-pointer z-50" onclick="toggleModal('origin-modal')"><i class="fas fa-times text-gray-500 hover:text-gray-800 text-xl transition"></i></div>
            </div>
            <div class="px-6 sm:px-8 py-6 text-left"><div id="modal-origin-content" class="prose prose-blue max-w-none text-gray-600 space-y-4 text-sm sm:text-base"></div></div>
            <div class="flex justify-end pt-4 pb-6 px-6 bg-gray-50 rounded-b-xl border-t border-gray-100">
                <button onclick="toggleModal('origin-modal')" class="bg-thuBlue hover:bg-blue-800 text-white font-bold py-2 px-6 rounded-lg transition duration-300">關閉視窗</button>
            </div>
        </div>
    </div>

    <div id="contact-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-[100]">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50" onclick="toggleModal('contact-modal')"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-5xl mx-auto rounded-2xl shadow-2xl z-50 flex flex-col max-h-[90vh]">
            <div class="flex-none flex justify-between items-center py-4 sm:py-5 px-6 sm:px-8 border-b border-gray-200 bg-white rounded-t-2xl z-10">
                <div class="flex items-center gap-3"><i class="fas fa-address-book text-thuGold text-xl sm:text-2xl"></i><p class="text-xl sm:text-2xl font-bold text-thuBlue">聯絡資訊</p></div>
                <div class="cursor-pointer z-50" onclick="toggleModal('contact-modal')"><i class="fas fa-times text-gray-500 hover:text-gray-800 text-xl sm:text-2xl transition"></i></div>
            </div>
            <div class="flex-grow overflow-y-auto px-4 sm:px-8 py-6 sm:py-8 bg-gray-50">
                <div class="mb-6 text-center bg-blue-50 border border-blue-100 rounded-xl p-4 sm:p-5">
                    <p class="text-gray-700 font-medium text-sm sm:text-base"><i class="fas fa-info-circle text-thuBlue mr-2"></i>如果您在操作上有任何問題，歡迎聯繫實習與學生成就中心或相關承辦人員。</p>
                </div>
                <div id="contacts-container" class="flex flex-col gap-6">
                    <div class="text-center text-gray-400">載入中...</div>
                </div>
            </div>
            <div class="flex-none flex justify-end py-4 sm:py-5 px-6 sm:px-8 bg-white border-t border-gray-100 rounded-b-2xl z-10">
                <button onclick="toggleModal('contact-modal')" class="bg-thuBlue hover:bg-blue-800 text-white font-bold py-2 px-8 rounded-lg transition duration-300 text-base shadow-md">關閉</button>
            </div>
        </div>
    </div>

    <div id="news-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-[100]">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50" onclick="toggleModal('news-modal')"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-3xl mx-auto rounded-xl shadow-2xl z-50 overflow-y-auto max-h-[90vh]">
            <div class="flex justify-between items-center py-4 px-6 border-b border-gray-200 sticky top-0 bg-white">
                <div class="flex items-center gap-2">
                    <i class="fas fa-bullhorn text-thuGold text-xl"></i>
                    <p class="text-xl font-bold text-thuBlue">公告詳情</p>
                </div>
                <div class="cursor-pointer z-50" onclick="toggleModal('news-modal')"><i class="fas fa-times text-gray-500 hover:text-gray-800 text-xl transition"></i></div>
            </div>
            <div class="px-6 sm:px-8 py-6 text-left">
                <div class="mb-4">
                    <span id="modal-news-date" class="text-sm text-gray-500 font-mono"></span>
                    <h2 id="modal-news-title" class="text-xl sm:text-2xl font-bold text-gray-800 mt-1"></h2>
                </div>
                <hr class="border-gray-200 mb-4">
                <div id="modal-news-content" class="prose prose-blue max-w-none text-gray-600 space-y-4 leading-relaxed text-sm sm:text-base"></div>
            </div>
            <div class="flex justify-end pt-4 pb-6 px-6 bg-gray-50 rounded-b-xl border-t border-gray-100">
                <button onclick="toggleModal('news-modal')" class="bg-thuBlue hover:bg-blue-800 text-white font-bold py-2 px-6 rounded-lg transition duration-300">關閉</button>
            </div>
        </div>
    </div>

    <div id="all-news-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-[100]">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50" onclick="toggleModal('all-news-modal')"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-4xl mx-auto rounded-xl shadow-2xl z-50 flex flex-col max-h-[90vh]">
            <div class="flex-none flex justify-between items-center py-4 sm:py-5 px-6 sm:px-8 border-b border-gray-200 bg-white rounded-t-xl z-10">
                <div class="flex items-center gap-3">
                    <i class="fas fa-list-ul text-thuGold text-2xl"></i>
                    <p class="text-xl sm:text-2xl font-bold text-thuBlue">所有公告</p>
                </div>
                <div class="cursor-pointer z-50" onclick="toggleModal('all-news-modal')"><i class="fas fa-times text-gray-500 hover:text-gray-800 text-xl sm:text-2xl transition"></i></div>
            </div>
            <div class="flex-none px-6 sm:px-8 pt-6 pb-2 bg-gray-50">
                <div class="flex flex-col sm:flex-row gap-3">
                    <div class="relative flex-grow">
                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input type="text" id="news-search" placeholder="搜尋公告標題..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-thuBlue outline-none text-sm transition-all" oninput="renderAllNewsUI(true)">
                    </div>
                    <select id="news-filter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-thuBlue outline-none text-sm bg-white text-gray-600 min-w-[120px] cursor-pointer" onchange="renderAllNewsUI(true)">
                        <option value="all">所有類型</option>
                    </select>
                </div>
            </div>
            <div class="flex-grow overflow-y-auto px-6 sm:px-8 py-2 bg-gray-50 min-h-[300px]">
                <ul id="all-news-list" class="space-y-2"></ul>
                <div id="no-news-msg" class="hidden text-center py-10 text-gray-400">
                    <i class="fas fa-inbox text-4xl mb-2"></i><p>沒有符合條件的公告</p>
                </div>
            </div>
            <div class="flex-none bg-white border-t border-gray-100 rounded-b-xl z-10">
                <div id="news-pagination" class="flex justify-center items-center gap-2 py-3 border-b border-gray-50"></div>
                <div class="flex justify-end py-4 px-6 sm:px-8">
                    <button onclick="toggleModal('all-news-modal')" class="bg-thuBlue hover:bg-blue-800 text-white font-bold py-2 px-8 rounded-lg transition duration-300">關閉</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. 程式邏輯 (資料來源改為 Fetch data.json)
        // ==========================================
        
        // Color Map 邏輯
        const colorMap = {
            'thu': { border: 'border-thuBlue', icon: 'bg-thuBlue', text: 'text-thuBlue', hoverText: 'group-hover:text-thuBlue' },
            'gold': { border: 'border-thuGold', icon: 'bg-thuGold', text: 'text-thuGold', hoverText: 'group-hover:text-thuGold', isGradient: true },
            'blue': { border: 'border-blue-500', icon: 'bg-blue-500', text: 'text-blue-600', hoverText: 'group-hover:text-blue-800' },
            'purple': { border: 'border-purple-500', icon: 'bg-purple-500', text: 'text-purple-600', hoverText: 'group-hover:text-purple-800' },
            'orange': { border: 'border-orange-500', icon: 'bg-orange-500', text: 'text-orange-600', hoverText: 'group-hover:text-orange-800' },
            'green': { border: 'border-green-500', icon: 'bg-green-500', text: 'text-green-600', hoverText: 'group-hover:text-green-800' },
            'red': { border: 'border-red-500', icon: 'bg-red-500', text: 'text-red-600', hoverText: 'group-hover:text-red-800' },
            'teal': { border: 'border-teal-500', icon: 'bg-teal-500', text: 'text-teal-600', hoverText: 'group-hover:text-teal-800' },
            'indigo': { border: 'border-indigo-500', icon: 'bg-indigo-500', text: 'text-indigo-600', hoverText: 'group-hover:text-indigo-800' },
            'cyan': { border: 'border-cyan-500', icon: 'bg-cyan-500', text: 'text-cyan-600', hoverText: 'group-hover:text-cyan-800' },
            'rose': { border: 'border-rose-500', icon: 'bg-rose-500', text: 'text-rose-600', hoverText: 'group-hover:text-rose-800' },
            // 自定義顏色
            'thublue': { border: 'border-thuBlue', icon: 'bg-thuBlue', text: 'text-thuBlue', hoverText: 'group-hover:text-thuBlue' },
            'lapisyellow': { border: 'border-lapisYellow', icon: 'bg-lapisYellow', text: 'text-lapisYellow', hoverText: 'group-hover:text-lapisYellow' },
            'concretegrey': { border: 'border-concreteGrey', icon: 'bg-concreteGrey', text: 'text-concreteGrey', hoverText: 'group-hover:text-concreteGrey' },
            'brickred': { border: 'border-brickRed', icon: 'bg-brickRed', text: 'text-brickRed', hoverText: 'group-hover:text-brickRed' },
            'windowblack': { border: 'border-windowBlack', icon: 'bg-windowBlack', text: 'text-windowBlack', hoverText: 'group-hover:text-windowBlack' },
            'acaciagreen': { border: 'border-acaciaGreen', icon: 'bg-acaciaGreen', text: 'text-acaciaGreen', hoverText: 'group-hover:text-acaciaGreen' },
            'milkwhite': { border: 'border-gray-200', icon: 'bg-milkWhite !text-gray-700', text: 'text-gray-600', hoverText: 'group-hover:text-gray-800' },
            'lakeblue': { border: 'border-lakeBlue', icon: 'bg-lakeBlue', text: 'text-lakeBlue', hoverText: 'group-hover:text-lakeBlue' },
            'phoenixorange': { border: 'border-phoenixOrange', icon: 'bg-phoenixOrange', text: 'text-phoenixOrange', hoverText: 'group-hover:text-phoenixOrange' },
            'glorygold': { border: 'border-gloryGold', icon: 'bg-gloryGold', text: 'text-gloryGold', hoverText: 'group-hover:text-gloryGold' },
            'thubluenew': { border: 'border-thuBlueNew', icon: 'bg-thuBlueNew', text: 'text-thuBlueNew', hoverText: 'group-hover:text-thuBlueNew' },
            'grassgreen': { border: 'border-grassGreen', icon: 'bg-grassGreen', text: 'text-grassGreen', hoverText: 'group-hover:text-grassGreen' }
        };

        const contactColorMap = {
            'thu': { bg: 'bg-blue-50', text: 'text-thuBlue', badge: 'bg-gray-100 text-gray-600', border: 'hover:border-thuBlue' },
            'gold': { bg: 'bg-yellow-50', text: 'text-yellow-700', badge: 'bg-yellow-100 text-yellow-800', border: 'hover:border-yellow-500' },
            'purple': { bg: 'bg-purple-50', text: 'text-purple-600', badge: 'bg-purple-100 text-purple-800', border: 'hover:border-purple-500' },
            'orange': { bg: 'bg-orange-50', text: 'text-orange-600', badge: 'bg-orange-100 text-orange-800', border: 'hover:border-orange-500' },
            'blue': { bg: 'bg-blue-50', text: 'text-blue-600', badge: 'bg-blue-100 text-blue-800', border: 'hover:border-blue-500' },
            'default': { bg: 'bg-gray-50', text: 'text-gray-600', badge: 'bg-gray-200 text-gray-700', border: 'hover:border-gray-400' },
            'office': { bg: 'bg-green-50', text: 'text-green-600', badge: 'bg-green-100 text-green-800', border: 'hover:border-green-500' },
            // 自定義顏色
            'thubluenew': { bg: 'bg-blue-50', text: 'text-thuBlueNew', badge: 'bg-blue-100 text-blue-900', border: 'hover:border-thuBlueNew' },
            'glorygold': { bg: 'bg-yellow-50', text: 'text-gloryGold', badge: 'bg-yellow-100 text-yellow-800', border: 'hover:border-gloryGold' },
            'lapisyellow': { bg: 'bg-orange-50', text: 'text-lapisYellow', badge: 'bg-orange-100 text-orange-800', border: 'hover:border-lapisYellow' },
            'phoenixorange': { bg: 'bg-red-50', text: 'text-phoenixOrange', badge: 'bg-red-100 text-red-800', border: 'hover:border-phoenixOrange' },
            'brickred': { bg: 'bg-red-50', text: 'text-brickRed', badge: 'bg-red-100 text-red-900', border: 'hover:border-brickRed' },
            'grassgreen': { bg: 'bg-green-50', text: 'text-grassGreen', badge: 'bg-green-100 text-green-800', border: 'hover:border-grassGreen' },
            'acaciagreen': { bg: 'bg-green-50', text: 'text-acaciaGreen', badge: 'bg-green-100 text-green-900', border: 'hover:border-acaciaGreen' },
            'lakeblue': { bg: 'bg-teal-50', text: 'text-lakeBlue', badge: 'bg-teal-100 text-teal-800', border: 'hover:border-lakeBlue' },
            'concretegrey': { bg: 'bg-gray-100', text: 'text-concreteGrey', badge: 'bg-gray-200 text-gray-700', border: 'hover:border-concreteGrey' },
            'windowblack': { bg: 'bg-gray-200', text: 'text-windowBlack', badge: 'bg-gray-300 text-gray-800', border: 'hover:border-windowBlack' },
            'milkwhite': { bg: 'bg-white', text: 'text-gray-500', badge: 'bg-gray-100 text-gray-600', border: 'hover:border-gray-300' }
        };

        let currentNewsPage = 1;
        const newsPerPage = 5;
        let siteNews = []; 
        let filteredNews = [];
        let siteContacts = [];
        
        let initialLoadStartTime = Date.now();
        const minLoadingTime = 500;
        const maxSimulatedProgress = 90;

        // 輔助函式
        const setText = (id, val) => { if(document.getElementById(id)) document.getElementById(id).innerText = val || ''; };
        const setHTML = (id, val) => { if(document.getElementById(id)) document.getElementById(id).innerHTML = val || ''; };
        const toggleModal = (id) => {
            const m = document.getElementById(id); m.classList.toggle('opacity-0'); m.classList.toggle('pointer-events-none'); document.querySelector('body').classList.toggle('modal-active');
        };

        // 模擬進度條更新
        function updateProgress(progress) {
            const percentElement = document.getElementById('loading-percent');
            if (percentElement) {
                percentElement.innerText = `${Math.min(100, progress)}%`;
            }
        }

        // 隱藏載入畫面
        function hideLoadingOverlay() {
            const totalElapsedTime = Date.now() - initialLoadStartTime;
            const requiredDelay = Math.max(0, 3000 - totalElapsedTime); 

            updateProgress(100);

            setTimeout(() => {
                const overlay = document.getElementById('loading-overlay');
                if (overlay) {
                    overlay.style.opacity = '0';
                    setTimeout(() => {
                        overlay.style.display = 'none';
                    }, 500); 
                }
            }, requiredDelay);
        }

        // 滾動到頂部功能
        window.scrollToTop = function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        };
        
        // 自訂滾動邏輯
        window.customScrollToMain = function() {
            const mainContent = document.getElementById('main-content');
            const stickyHeader = document.getElementById('sticky-header');
            
            if (mainContent && stickyHeader) {
                const headerHeight = stickyHeader.offsetHeight || 64; 
                const targetPosition = mainContent.offsetTop - headerHeight;
                
                window.scrollTo({
                    top: targetPosition,
                    behavior: 'smooth'
                });
            }
        };


        // 控制滾動按鈕顯示/隱藏
        document.addEventListener('scroll', function() {
            const button = document.getElementById('scroll-to-top');
            if (window.scrollY > 300) {
                if (button) button.classList.add('show');
            } else {
                if (button) button.classList.remove('show');
            }
        });


        // 頁面載入初始化
        document.addEventListener('DOMContentLoaded', async function() {
            
            // 步驟 1: 模擬開始載入
            let progress = 0;
            const interval = setInterval(() => {
                if (progress < maxSimulatedProgress) {
                    progress += 5; 
                }
                updateProgress(progress);
            }, 100);


            try {
                // 步驟 2: 讀取 JSON 資料
                const response = await fetch(`data.json?t=${new Date().getTime()}`);
                if (!response.ok) throw new Error("無法讀取資料庫");
                const data = await response.json();

                // === 新增：動態注入顏色變數，實現與後台同步 ===
                if (data.colors) {
                    const rootStyle = document.documentElement.style;
                    // 設定預設值 (確保 data.json 異常時仍有顏色)
                    rootStyle.setProperty('--color-thu', '#002E5D');
                    rootStyle.setProperty('--color-glorygold', '#C6A87C');

                    data.colors.forEach(c => {
                        // 將 ID 轉為小寫並設定為 CSS 變數 (例如 thublue -> --color-thublue)
                        if(c.id && c.hex) {
                            rootStyle.setProperty(`--color-${c.id.toLowerCase()}`, c.hex);
                        }
                    });
                }
                // ===========================================

                // 停止模擬進度
                clearInterval(interval);
                updateProgress(maxSimulatedProgress);

                // 步驟 3: 處理資料
                const settings = data.settings;
                const cards = data.cards;
                siteContacts = data.contacts;
                siteNews = data.news || [];
                
                // 排序新聞 (降序)
                siteNews.sort((a, b) => new Date(b.Date) - new Date(a.Date));

                // 步驟 4: 渲染內容
                renderSettings(settings);
                renderCards(cards);
                renderContacts(siteContacts);
                renderNewsWidget(siteNews);

                // 步驟 5: 完成載入
                hideLoadingOverlay();


            } catch (error) {
                console.error("Error loading data:", error);
                clearInterval(interval);
                updateProgress(100);
                hideLoadingOverlay();

                document.getElementById('cards-container').innerHTML = `<div class="col-span-full text-center text-red-500 p-10 bg-white rounded-xl shadow-lg">資料載入失敗，請確認 data.json 是否存在。</div>`;
                document.getElementById('news-container').classList.add('hidden');
            }
        });

        function renderSettings(settings) {
            if (!settings) return;
            document.title = settings.SiteTitle;
            // 矮頁首標題修正為完整名稱
            document.getElementById('sticky-header').querySelector('#nav-title').innerText = settings.SiteTitle; 
            setText('hero-eng-title', settings.SiteEngTitle);
            setHTML('hero-subtitle', settings.HeroSubtitle);
            setText('footer-copyright', settings.Copyright);
            setText('modal-origin-title', settings.OriginTitle);
            setHTML('modal-origin-content', settings.OriginContent);

            const fullTitle = settings.SiteTitle || "";
            const keyword = "協作平台";
            
            // 標題切割邏輯
            if (fullTitle.includes(keyword)) {
                const parts = fullTitle.split(keyword);
                setText('hero-title-1', parts[0]);
                setText('hero-title-2', keyword + (parts[1] || "")); 
            } else { 
                setText('hero-title-1', fullTitle); 
                setText('hero-title-2', ""); 
            }

            if (settings.LogoUrl) {
                document.querySelectorAll('img[alt="Logo"]').forEach(img => { img.src = settings.LogoUrl; img.classList.remove('hidden'); });
            }
        }

        function renderCards(data) {
            const container = document.getElementById('cards-container'); container.innerHTML = ''; 
            if (!data) return;

            data.forEach(item => {
                const colorKey = (item.Type || 'thu').toLowerCase();
                const theme = colorMap[colorKey] || colorMap['thu'];
                const bgClass = theme.isGradient ? 'bg-gradient-to-br from-white to-blue-50' : 'bg-white';
                const badgeHtml = item.Badge ? `<div class="absolute top-0 right-0 ${theme.icon} text-white text-[10px] font-bold px-2 py-0.5 rounded-bl-lg">${item.Badge}</div>` : '';
                
                const externalLink = item.Link.startsWith('http') || item.Link.startsWith('tools/');
                const target = externalLink ? 'target="_blank"' : '';

                container.innerHTML += `
                <a href="${item.Link}" ${target} class="group flex flex-col h-full ${bgClass} rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden transform hover:-translate-y-2 border-t-4 ${theme.border} relative">
                    ${badgeHtml}
                    <div class="p-8 flex-grow">
                        <div class="w-16 h-16 ${theme.icon} text-white rounded-2xl flex items-center justify-center text-3xl mb-6 group-hover:scale-110 transition-transform duration-300"><i class="fas ${item.Icon}"></i></div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-3 ${theme.hoverText} transition-colors">${item.Title}</h3>
                        <p class="text-gray-500 leading-relaxed">${item.Description}</p>
                    </div>
                    <div class="bg-white/50 px-8 py-4 border-t border-gray-100 flex justify-between items-center">
                        <span class="text-sm font-medium ${theme.text}">${theme.isGradient ? '立即使用' : '查看詳情'}</span>
                        <i class="fas fa-arrow-right ${theme.text} opacity-0 group-hover:opacity-100 transform translate-x-[-10px] group-hover:translate-x-0 transition-all"></i>
                    </div>
                </a>`;
            });
        }

        function renderContacts(data) {
            const container = document.getElementById('contacts-container'); container.innerHTML = '';
            if (!data) return;

            const office = data.find(d => d.Type === 'office');
            const staff = data.filter(d => d.Type !== 'office');
            if (office) {
                const c = contactColorMap['office'] || contactColorMap['default'];
                container.innerHTML += `
                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200 hover:border-green-500 transition-colors flex flex-col md:flex-row items-center justify-between gap-5 mb-6">
                    <div class="flex items-center gap-4">
                        <div class="w-14 h-14 rounded-full ${c.bg} ${c.text} flex items-center justify-center font-bold text-2xl shrink-0"><i class="fas fa-building"></i></div>
                        <div class="text-center md:text-left"><h4 class="text-xl font-bold text-gray-800">${office.Name}</h4><span class="text-sm ${c.badge} px-2.5 py-1 rounded-md mt-1 inline-block">${office.Title}</span></div>
                    </div>
                    <div class="flex flex-col md:items-end text-center md:text-right">
                        <div class="flex items-center gap-2 mb-1 justify-center md:justify-end"><i class="fas fa-envelope text-gray-400 text-lg"></i><a href="mailto:${office.Email}" class="text-thuBlue font-bold text-xl hover:underline">${office.Email}</a></div>
                        <p class="text-sm text-gray-500">${office.Description || ''}</p>
                    </div>
                </div>`;
            }
            let staffHtml = '<div class="grid grid-cols-1 md:grid-cols-3 gap-5">';
            staff.forEach(p => {
                const colorKey = (p.Type || 'blue').toLowerCase();
                const c = contactColorMap[colorKey] || contactColorMap['default'];
                staffHtml += `
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 ${c.border} transition-colors flex flex-col h-full">
                    <div class="flex items-center gap-3 mb-5 border-b border-gray-100 pb-4">
                        <div class="w-12 h-12 rounded-full ${c.bg} ${c.text} flex items-center justify-center font-bold text-xl shrink-0">${p.Name.charAt(0)}</div>
                        <div class="min-w-0"><h4 class="text-lg font-bold text-gray-800 truncate">${p.Name}</h4><span class="text-sm ${c.badge} px-2 py-0.5 rounded mt-1 inline-block">${p.Title}</span></div>
                    </div>
                    <div class="space-y-2 text-sm text-gray-600 flex-grow">
                        <div class="flex items-start gap-2"><i class="fas fa-tasks mt-1 text-thuGold w-3"></i>
                            <div><p class="font-medium text-gray-700 mb-0.5">負責業務：</p><ul class="list-disc list-inside text-gray-500 space-y-0.5 pl-0.5">${p.Description ? p.Description.split('\n').map(i => `<li>${i}</li>`).join('') : ''}</ul></div>
                        </div>
                    </div>
                    <div class="mt-5 pt-3 border-t border-gray-100 space-y-2 text-sm">
                        <div class="flex items-center gap-2"><i class="fas fa-phone-alt text-gray-400 w-3"></i><a href="tel:${p.Phone}" class="text-thuBlue font-medium hover:underline">${p.Phone}</a></div>
                        <div class="flex items-center gap-2"><i class="fas fa-envelope text-gray-400 w-3"></i><a href="mailto:${p.Email}" class="text-thuBlue font-medium hover:underline truncate">${p.Email}</a></div>
                    </div>
                </div>`;
            });
            staffHtml += '</div>'; container.innerHTML += staffHtml;
        }

        // === NEWS LOGIC ===
        
        function renderNewsWidget(data) {
            const heroList = document.getElementById('news-list');
            const wrapper = document.getElementById('news-container');
            const moreBtn = document.getElementById('view-more-news-btn');
            heroList.innerHTML = '';

            if (!data || data.length === 0) {
                wrapper.classList.add('hidden');
                return;
            }
            wrapper.classList.remove('hidden');
            wrapper.classList.add('animate-fade-in-up'); // Ensure animation works after load

            if (data.length > 3) moreBtn.classList.remove('hidden');
            else moreBtn.classList.add('hidden');

            data.slice(0, 3).forEach((item, index) => {
                const isNew = item.IsNew === true || item.IsNew === 'TRUE' || item.IsNew === 'true';
                const newBadge = isNew ? '<span class="bg-red-500 text-white text-[10px] px-1.5 py-0.5 rounded ml-2 align-middle">NEW</span>' : '';
                const typeBadge = item.Type ? `<span class="text-xs text-blue-300 border border-blue-300/30 px-1.5 py-0.5 rounded mr-2">${item.Type}</span>` : '';

                const hasLink = item.Link && item.Link.trim() !== '' && item.Link.trim() !== '#';
                const href = hasLink ? item.Link : 'javascript:void(0)';
                const target = hasLink ? 'target="_blank"' : '';
                const onClick = hasLink ? '' : `onclick="openNewsModal(${index})"`;

                heroList.innerHTML += `
                <li class="flex items-start gap-3 hover:bg-white/5 p-1 rounded transition-colors">
                    <div class="flex-shrink-0 mt-0.5 text-thuGold font-mono whitespace-nowrap">${item.Date}</div>
                    <div class="flex-grow min-w-0">
                        ${typeBadge}
                        <a href="${href}" ${target} ${onClick} class="hover:text-white hover:underline transition-colors leading-relaxed cursor-pointer truncate block">
                            ${item.Title} ${newBadge}
                        </a>
                    </div>
                </li>`;
            });
            
            initNewsFilters();
        }

        function initNewsFilters() {
            const types = [...new Set(siteNews.map(n => n.Type || '一般公告'))];
            const select = document.getElementById('news-filter');
            select.innerHTML = '<option value="all">所有類型</option>';
            types.forEach(t => { select.innerHTML += `<option value="${t}">${t}</option>`; });
        }

        function renderAllNewsUI(resetPage = false) {
            const search = document.getElementById('news-search').value.toLowerCase();
            const type = document.getElementById('news-filter').value;
            
            // 1. Filtering
            filteredNews = siteNews.filter(item => {
                const matchSearch = item.Title.toLowerCase().includes(search);
                const matchType = type === 'all' || (item.Type || '一般公告') === type;
                return matchSearch && matchType;
            });

            // 2. Pagination State
            if (resetPage) currentNewsPage = 1;
            
            const totalPages = Math.ceil(filteredNews.length / newsPerPage);
            if (currentNewsPage > totalPages) currentNewsPage = totalPages > 0 ? totalPages : 1;
            if (currentNewsPage < 1) currentNewsPage = 1;

            const start = (currentNewsPage - 1) * newsPerPage;
            const end = start + newsPerPage;
            const pageItems = filteredNews.slice(start, end);

            // 3. Render List
            const list = document.getElementById('all-news-list');
            const noMsg = document.getElementById('no-news-msg');
            list.innerHTML = '';

            if (pageItems.length === 0) {
                noMsg.classList.remove('hidden');
            } else {
                noMsg.classList.add('hidden');
                pageItems.forEach(item => {
                    const originalIndex = siteNews.indexOf(item); 
                    let dateStr = item.Date;
                    
                    const hasLink = item.Link && item.Link.trim() !== '' && item.Link.trim() !== '#';
                    const href = hasLink ? item.Link : 'javascript:void(0)';
                    const target = hasLink ? 'target="_blank"' : '';
                    const onClick = hasLink ? '' : `onclick="openNewsModal(${originalIndex});"`; 
                    const typeTag = item.Type ? `<span class="text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full mr-2">${item.Type}</span>` : '';

                    list.innerHTML += `
                    <li class="border-b border-gray-100 pb-3 last:border-0">
                        <div class="flex flex-col sm:flex-row sm:items-center gap-1 sm:gap-3">
                            <div class="flex items-center gap-2 shrink-0">
                                <span class="text-gray-400 font-mono text-sm">${dateStr}</span>
                                ${typeTag}
                            </div>
                            <a href="${href}" ${target} ${onClick} class="text-gray-700 hover:text-thuBlue hover:underline font-medium cursor-pointer block truncate">
                                ${item.Title}
                            </a>
                        </div>
                    </li>`;
                });
            }

            // 4. Render Pagination
            const pag = document.getElementById('news-pagination');
            pag.innerHTML = '';
            if (totalPages > 1) {
                pag.innerHTML += `<button onclick="changePage(${currentNewsPage - 1})" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 disabled:opacity-50" ${currentNewsPage === 1 ? 'disabled' : ''}><i class="fas fa-chevron-left text-gray-500"></i></button>`;
                for (let i = 1; i <= totalPages; i++) {
                    const activeClass = i === currentNewsPage ? 'bg-thuBlue text-white' : 'bg-white text-gray-600 hover:bg-gray-100';
                    pag.innerHTML += `<button onclick="changePage(${i})" class="w-8 h-8 flex items-center justify-center rounded-full text-sm font-bold transition-colors ${activeClass}">${i}</button>`;
                }
                pag.innerHTML += `<button onclick="changePage(${currentNewsPage + 1})" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 disabled:opacity-50" ${currentNewsPage === totalPages ? 'disabled' : ''}><i class="fas fa-chevron-right text-gray-500"></i></button>`;
            }
        }

        window.changePage = function(p) { currentNewsPage = p; renderAllNewsUI(false); };
        window.openAllNewsModal = function() { renderAllNewsUI(true); toggleModal('all-news-modal'); };
        window.openNewsModal = function(index) {
            const item = siteNews[index];
            if(!item) return;
            document.getElementById('modal-news-date').innerText = item.Date;
            document.getElementById('modal-news-title').innerText = item.Title;
            const typeBadge = item.Type ? `<span class=\"inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded mb-2\">${item.Type}</span><br>` : '';
            document.getElementById('modal-news-content').innerHTML = typeBadge + (item.Content || "無詳細內容");
            toggleModal('news-modal');
        };

        document.onkeydown = function(evt) { if((evt.key==="Escape"||evt.keyCode===27)) document.querySelectorAll('.modal:not(.opacity-0)').forEach(m=>toggleModal(m.id)); };
        
        // --- Custom Scroll Logic for Footer ---
        const heroHeightThreshold = 600; 
        window.addEventListener('scroll', () => { 
            const stickyHeader = document.getElementById('sticky-header'); 
            const footerTrigger = document.getElementById('footer-trigger'); 
            
            if(window.scrollY > 200){ 
                stickyHeader.classList.remove('-translate-y-full','opacity-0'); 
                stickyHeader.classList.add('translate-y-0','opacity-100'); 
            } else { 
                stickyHeader.classList.add('-translate-y-full','opacity-0'); 
                stickyHeader.classList.remove('translate-y-0','opacity-100'); 
            }

            // 控制版權頁顯示
            if (window.scrollY >= window.innerHeight * 0.9) {
                footerTrigger.classList.remove('hidden');
            } else {
                footerTrigger.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
