<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>載入中...</title>
    <!-- 外部資源 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        thuBlue: '#002E5D',
                        thuLightBlue: '#eef6fc',
                        thuGold: '#C6A87C',
                    },
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* 自定義樣式 */
        .hero-bg {
            background: linear-gradient(135deg, #002E5D 0%, #001a35 100%);
            position: relative;
            overflow: hidden;
        }
        .hero-bg::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 30px 30px; z-index: 1;
        }
        .modal { transition: opacity 0.25s ease; }
        body.modal-active { overflow-y: hidden !important; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in-up { animation: fadeInUp 0.8s ease-out forwards; }
        
        /* 預覽模式橫幅動畫 */
        .preview-banner { animation: slideDown 0.5s ease-out forwards; }
        @keyframes slideDown { from { transform: translateY(-100%); } to { transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-100 font-sans text-gray-700 flex flex-col min-h-screen pb-16">

    <!-- 隱藏功能：測試模式上傳入口 (Hidden Input) -->
    <input type="file" id="debug-file-input" accept=".xlsx" class="hidden" />

    <!-- 隱藏功能：預覽模式警告橫幅 -->
    <div id="preview-banner" class="hidden fixed top-0 left-0 w-full bg-red-600 text-white z-[100] px-4 py-2 text-center shadow-md text-sm font-bold preview-banner">
        <i class="fas fa-wrench mr-2"></i> 目前為「測試預覽模式」 - 顯示內容來自您上傳的檔案，非網站實際內容。
        <button onclick="location.reload()" class="ml-4 underline hover:text-red-200">關閉預覽 (重新整理)</button>
    </div>

    <!-- Sticky Header (動態載入) -->
    <nav id="sticky-header" class="fixed top-0 left-0 w-full bg-thuBlue/95 backdrop-blur-sm shadow-lg z-40 transition-all duration-500 ease-in-out -translate-y-full opacity-0 flex items-center h-16 px-4 sm:px-8">
        <div class="w-full max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <img id="nav-logo" src="" alt="Logo" class="h-8 w-auto hidden">
                <div class="text-white leading-none flex flex-col justify-center">
                    <span class="font-bold text-lg tracking-widest" id="nav-title"></span>
                </div>
            </div>
            <a href="https://www.thu.edu.tw/" target="_blank" class="flex items-center gap-2 text-white hover:text-thuGold transition-colors text-sm font-medium">
                <i class="fa-solid fa-house"></i> <span class="hidden sm:inline">東海大學首頁</span>
            </a>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="hero-bg text-white pb-32 pt-24 relative">
        <div class="absolute top-6 right-6 z-30">
            <a href="https://www.thu.edu.tw/" target="_blank" class="flex items-center gap-2 px-4 py-2 bg-white/10 text-white border border-white/20 rounded-full hover:bg-white hover:text-thuBlue transition-all duration-300 font-medium backdrop-blur-sm shadow-sm">
                <i class="fa-solid fa-house"></i> 東海大學首頁
            </a>
        </div>
        <div class="absolute top-0 left-0 w-full h-full overflow-hidden z-0 pointer-events-none">
             <div class="absolute -top-20 -right-20 w-96 h-96 bg-thuGold opacity-10 rounded-full blur-3xl"></div>
             <div class="absolute top-40 -left-20 w-72 h-72 bg-blue-400 opacity-10 rounded-full blur-3xl"></div>
        </div>

        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10 text-center flex flex-col items-center justify-center min-h-[40vh]">
            <div class="flex flex-col md:flex-row items-center justify-center gap-8 md:gap-12 mb-8 animate-fade-in-up group cursor-default">
                <img id="hero-logo" src="" alt="Logo" class="h-20 w-auto drop-shadow-lg opacity-90 transition-all duration-500 ease-out group-hover:opacity-100 group-hover:scale-110 group-hover:drop-shadow-[0_0_15px_rgba(255,255,255,0.6)] hidden">
                <div class="text-center flex flex-col justify-center items-center h-20">
                    <h1 class="text-3xl md:text-5xl font-bold tracking-widest leading-none drop-shadow-xl mb-1 transition-all duration-500 ease-out group-hover:scale-110 group-hover:tracking-[0.15em] group-hover:drop-shadow-[0_0_15px_rgba(255,255,255,0.6)]">
                        <span id="hero-title-1"></span><span class="text-thuGold transition-colors duration-300 group-hover:text-white" id="hero-title-2"></span>
                    </h1>
                    <p id="hero-eng-title" class="text-base text-blue-200 tracking-wide font-light hidden md:block opacity-90 transition-all duration-500 group-hover:text-white group-hover:tracking-widest group-hover:drop-shadow-[0_0_5px_rgba(255,255,255,0.8)]"></p>
                </div>
            </div>
            <p id="hero-subtitle" class="text-lg md:text-xl text-blue-100/80 font-light mb-12 max-w-2xl mx-auto leading-relaxed animate-fade-in-up" style="animation-delay: 0.2s; opacity: 0;"></p>
            <div class="flex flex-col sm:flex-row items-center justify-center gap-5 animate-fade-in-up w-full sm:w-auto" style="animation-delay: 0.4s; opacity: 0;">
                <button onclick="toggleModal('origin-modal')" class="group relative px-8 py-3.5 bg-thuGold hover:bg-[#b58f2a] text-white font-bold rounded-full transition-all duration-300 shadow-lg hover:shadow-orange-500/20 hover:-translate-y-1 overflow-hidden w-full sm:w-60">
                    <div class="absolute inset-0 w-full h-full bg-white/20 group-hover:translate-x-full transition-transform duration-500 -skew-x-12 -ml-4"></div>
                    <span class="relative flex items-center justify-center gap-2 text-lg"><i class="fas fa-feather-alt"></i> <span>查看計畫緣起</span></span>
                </button>
                <a href="https://aca.thu.edu.tw/web/isac/page.php?scid=112&sid=103" target="_blank" class="px-8 py-3.5 bg-white/5 hover:bg-white/10 text-white border border-white/20 backdrop-blur-sm font-medium rounded-full transition-all duration-300 hover:-translate-y-1 flex items-center justify-center gap-2 hover:border-white/40 w-full sm:w-60">
                    <i class="fa-solid fa-link text-blue-300"></i> 實習中心網頁
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 -mt-20 relative z-20 pb-20 flex-grow">
        <div id="cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <div class="col-span-full text-center py-10 text-white">
                <i class="fas fa-circle-notch fa-spin text-3xl mb-3"></i>
                <p>正在讀取 site_data.xlsx ...</p>
            </div>
        </div>
    </main>

    <!-- Fixed Footer -->
    <footer style="position: fixed; bottom: 0; left: 0; width: 100%; z-index: 50; background-color: #1f2937; color: #9ca3af; text-align: center; padding: 1rem 0; font-size: 0.75rem; border-top: 3px solid #C6A87C;">
        <div class="container mx-auto px-4">
            <div class="flex flex-col items-center justify-center gap-1">
                <p id="footer-copyright" class="font-bold text-white tracking-wide text-[10px]"></p>
                <p class="text-[9px] text-gray-500">網頁製作：張博堯 | Assisted by Google Gemini</p>
            </div>
        </div>
    </footer>

    <!-- Chatbot Button -->
    <div class="fixed bottom-20 right-8 z-40 flex flex-col items-end">
        <div class="bg-white text-gray-800 px-4 py-2 rounded-2xl shadow-lg border border-gray-100 text-sm font-bold mb-2 animate-bounce origin-bottom-right relative cursor-pointer" onclick="toggleModal('contact-modal')">
            需要協助嗎？
            <div class="absolute -bottom-1.5 right-6 w-3 h-3 bg-white transform rotate-45 border-r border-b border-gray-100"></div>
        </div>
        <button onclick="toggleModal('contact-modal')" class="w-14 h-14 bg-thuBlue hover:bg-blue-800 text-white rounded-full shadow-2xl flex items-center justify-center transition-all duration-300 hover:scale-110 hover:rotate-12 group focus:outline-none focus:ring-4 focus:ring-blue-300 border-2 border-white">
            <i class="fas fa-headset text-2xl group-hover:animate-pulse"></i>
        </button>
    </div>

    <!-- Modal 1: 計畫緣起 -->
    <div id="origin-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-[100]">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50" onclick="toggleModal('origin-modal')"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-2xl mx-auto rounded-xl shadow-2xl z-50 overflow-y-auto max-h-[90vh]">
            <div class="flex justify-between items-center py-4 px-6 border-b border-gray-200 sticky top-0 bg-white">
                <div class="flex items-center gap-2"><i class="fas fa-feather-alt text-thuGold text-xl"></i><p class="text-2xl font-bold text-thuBlue" id="modal-origin-title">計畫緣起</p></div>
                <div class="cursor-pointer z-50" onclick="toggleModal('origin-modal')"><i class="fas fa-times text-gray-500 hover:text-gray-800 text-xl transition"></i></div>
            </div>
            <div class="px-8 py-6 text-left"><div id="modal-origin-content" class="prose prose-blue max-w-none text-gray-600 space-y-4"></div></div>
            <div class="flex justify-end pt-4 pb-6 px-6 bg-gray-50 rounded-b-xl border-t border-gray-100">
                <button onclick="toggleModal('origin-modal')" class="bg-thuBlue hover:bg-blue-800 text-white font-bold py-2 px-6 rounded-lg transition duration-300">關閉視窗</button>
            </div>
        </div>
    </div>

    <!-- Modal 2: 聯絡資訊 -->
    <div id="contact-modal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-[100]">
        <div class="modal-overlay absolute w-full h-full bg-gray-900 opacity-50" onclick="toggleModal('contact-modal')"></div>
        <div class="modal-container bg-white w-11/12 md:max-w-5xl mx-auto rounded-2xl shadow-2xl z-50 flex flex-col max-h-[90vh]">
            <div class="flex-none flex justify-between items-center py-5 px-8 border-b border-gray-200 bg-white rounded-t-2xl z-10">
                <div class="flex items-center gap-3"><i class="fas fa-address-book text-thuGold text-2xl"></i><p class="text-2xl font-bold text-thuBlue">聯絡資訊</p></div>
                <div class="cursor-pointer z-50" onclick="toggleModal('contact-modal')"><i class="fas fa-times text-gray-500 hover:text-gray-800 text-2xl transition"></i></div>
            </div>
            <div class="flex-grow overflow-y-auto px-8 py-8 bg-gray-50">
                <div class="mb-6 text-center bg-blue-50 border border-blue-100 rounded-xl p-5">
                    <p class="text-gray-700 font-medium text-base"><i class="fas fa-info-circle text-thuBlue mr-2"></i>如果您在操作上有任何問題，歡迎聯繫實習與學生成就中心或相關承辦人員。</p>
                </div>
                <div id="contacts-container" class="flex flex-col gap-6"></div>
            </div>
            <div class="flex-none flex justify-end py-5 px-8 bg-white border-t border-gray-100 rounded-b-2xl z-10">
                <button onclick="toggleModal('contact-modal')" class="bg-thuBlue hover:bg-blue-800 text-white font-bold py-2 px-8 rounded-lg transition duration-300 text-base shadow-md">關閉</button>
            </div>
        </div>
    </div>

    <script>
        // --- 核心邏輯 ---
        
        // 1. 隱藏功能：監聽鍵盤事件開啟測試上傳
        document.addEventListener('keydown', function(e) {
            // 快捷鍵：Alt + Shift + P (Preview)
            if (e.altKey && e.shiftKey && (e.key === 'p' || e.key === 'P')) {
                e.preventDefault();
                // 觸發隱藏的檔案輸入框
                document.getElementById('debug-file-input').click();
            }
        });

        // 2. 處理檔案上傳與預覽
        document.getElementById('debug-file-input').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;

            try {
                const arrayBuffer = await file.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                
                // 使用上傳的檔案重新渲染頁面
                processWorkbook(workbook);
                
                // 顯示預覽模式警告
                document.getElementById('preview-banner').classList.remove('hidden');
                document.getElementById('sticky-header').classList.add('top-[36px]'); // 調整 header 位置避開 banner
                
                alert("✅ 預覽模式已啟動！\n\n您現在看到的內容來自您剛上傳的 Excel 檔。\n請注意：重新整理網頁後將會恢復原狀。");

            } catch (error) {
                alert("❌ 檔案讀取失敗！請確認您上傳的是正確的 site_data.xlsx 格式。");
                console.error(error);
            }
            // 清空 input 讓同一檔案可以再次觸發 change
            e.target.value = '';
        });

        // 3. 正常載入邏輯
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                const response = await fetch('./site_data.xlsx');
                if (!response.ok) throw new Error("無法讀取 site_data.xlsx");
                const arrayBuffer = await response.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                processWorkbook(workbook);
            } catch (error) {
                console.error("Error:", error);
                document.getElementById('cards-container').innerHTML = `<div class="col-span-full text-center text-white bg-red-500/50 p-4 rounded">讀取設定檔失敗，請確認 site_data.xlsx 存在。</div>`;
            }
        });

        // 4. 統一資料處理函式
        function processWorkbook(workbook) {
            renderSettings(XLSX.utils.sheet_to_json(workbook.Sheets['Settings']));
            renderCards(XLSX.utils.sheet_to_json(workbook.Sheets['Cards']));
            renderContacts(XLSX.utils.sheet_to_json(workbook.Sheets['Contacts']));
        }

        function renderSettings(data) {
            const settings = {}; data.forEach(row => { settings[row.Key] = row.Value; });
            const setText = (id, val) => { if(document.getElementById(id)) document.getElementById(id).innerText = val || ''; };
            const setHTML = (id, val) => { if(document.getElementById(id)) document.getElementById(id).innerHTML = val || ''; };
            
            document.title = settings['SiteTitle'];
            setText('nav-title', settings['SiteTitle']);
            setText('hero-eng-title', settings['SiteEngTitle']);
            setHTML('hero-subtitle', settings['HeroSubtitle']);
            setText('footer-copyright', settings['Copyright']);
            setText('modal-origin-title', settings['OriginTitle']);
            setHTML('modal-origin-content', settings['OriginContent']);

            const fullTitle = settings['SiteTitle'] || "";
            if (fullTitle.includes("協作平台")) {
                setText('hero-title-1', fullTitle.split("協作平台")[0]);
                setText('hero-title-2', "協作平台");
            } else { setText('hero-title-1', fullTitle); }

            if (settings['LogoUrl']) {
                document.querySelectorAll('img[alt="Logo"]').forEach(img => { img.src = settings['LogoUrl']; img.classList.remove('hidden'); });
            }
        }

        function renderCards(data) {
            const container = document.getElementById('cards-container'); container.innerHTML = ''; 
            data.forEach(item => {
                const isGold = item.Type === 'gold';
                const borderColor = isGold ? 'border-thuGold' : 'border-thuBlue';
                const iconBg = isGold ? 'bg-thuGold' : 'bg-thuBlue';
                const textColor = isGold ? 'text-thuGold' : 'text-thuBlue';
                const hoverColor = isGold ? 'group-hover:text-thuGold' : 'group-hover:text-thuBlue';
                const bgClass = isGold ? 'bg-gradient-to-br from-white to-blue-50' : 'bg-white';
                const badgeHtml = item.Badge ? `<div class="absolute top-0 right-0 ${isGold ? 'bg-thuGold' : 'bg-thuBlue'} text-white text-[10px] font-bold px-2 py-0.5 rounded-bl-lg">${item.Badge}</div>` : '';

                container.innerHTML += `
                <a href="${item.Link}" ${item.Link && item.Link.startsWith('http') ? 'target="_blank"' : ''} class="group flex flex-col h-full ${bgClass} rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden transform hover:-translate-y-2 border-t-4 ${borderColor} relative">
                    ${badgeHtml}
                    <div class="p-8 flex-grow">
                        <div class="w-16 h-16 ${iconBg} text-white rounded-2xl flex items-center justify-center text-3xl mb-6 group-hover:scale-110 transition-transform duration-300"><i class="fas ${item.Icon}"></i></div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-3 ${hoverColor} transition-colors">${item.Title}</h3>
                        <p class="text-gray-500 leading-relaxed">${item.Description}</p>
                    </div>
                    <div class="bg-white/50 px-8 py-4 border-t border-gray-100 flex justify-between items-center">
                        <span class="text-sm font-medium ${textColor}">${isGold ? '立即使用' : '查看詳情'}</span>
                        <i class="fas fa-arrow-right ${textColor} opacity-0 group-hover:opacity-100 transform translate-x-[-10px] group-hover:translate-x-0 transition-all"></i>
                    </div>
                </a>`;
            });
        }

        function renderContacts(data) {
            const container = document.getElementById('contacts-container'); container.innerHTML = '';
            const office = data.find(d => d.Type === 'office');
            const staff = data.filter(d => d.Type !== 'office');

            if (office) {
                container.innerHTML += `
                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200 hover:border-green-500 transition-colors flex flex-col md:flex-row items-center justify-between gap-5 mb-6">
                    <div class="flex items-center gap-4">
                        <div class="w-14 h-14 rounded-full bg-green-50 text-green-600 flex items-center justify-center font-bold text-2xl shrink-0"><i class="fas fa-building"></i></div>
                        <div class="text-center md:text-left"><h4 class="text-xl font-bold text-gray-800">${office.Name}</h4><span class="text-sm bg-green-100 text-green-800 px-2.5 py-1 rounded-md mt-1 inline-block">${office.Title}</span></div>
                    </div>
                    <div class="flex flex-col md:items-end text-center md:text-right">
                        <div class="flex items-center gap-2 mb-1 justify-center md:justify-end"><i class="fas fa-envelope text-gray-400 text-lg"></i><a href="mailto:${office.Email}" class="text-thuBlue font-bold text-xl hover:underline">${office.Email}</a></div>
                        <p class="text-sm text-gray-500">${office.Description || ''}</p>
                    </div>
                </div>`;
            }

            let staffHtml = '<div class="grid grid-cols-1 md:grid-cols-3 gap-5">';
            staff.forEach(p => {
                let c = { text: 'text-thuBlue', bg: 'bg-blue-50', badgeBg: 'bg-gray-100', badgeText: 'text-gray-600', border: 'hover:border-blue-500' };
                if (p.Title.includes('主任') && !p.Title.includes('副')) c = { text: 'text-purple-600', bg: 'bg-purple-50', badgeBg: 'bg-purple-100', badgeText: 'text-purple-800', border: 'hover:border-purple-500' };
                if (p.Title.includes('副主任')) c = { text: 'text-orange-600', bg: 'bg-orange-50', badgeBg: 'bg-orange-100', badgeText: 'text-orange-800', border: 'hover:border-orange-500' };
                staffHtml += `
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 ${c.border} transition-colors flex flex-col h-full">
                    <div class="flex items-center gap-3 mb-5 border-b border-gray-100 pb-4">
                        <div class="w-12 h-12 rounded-full ${c.bg} ${c.text} flex items-center justify-center font-bold text-xl shrink-0">${p.Name.charAt(0)}</div>
                        <div class="min-w-0"><h4 class="text-lg font-bold text-gray-800 truncate">${p.Name}</h4><span class="text-sm ${c.badgeBg} ${c.badgeText} px-2 py-0.5 rounded mt-1 inline-block">${p.Title}</span></div>
                    </div>
                    <div class="space-y-2 text-sm text-gray-600 flex-grow">
                        <div class="flex items-start gap-2"><i class="fas fa-tasks mt-1 text-thuGold w-3"></i>
                            <div><p class="font-medium text-gray-700 mb-0.5">負責業務：</p><ul class="list-disc list-inside text-gray-500 space-y-0.5 pl-0.5">${p.Description ? p.Description.split('\n').map(i => `<li>${i}</li>`).join('') : ''}</ul></div>
                        </div>
                    </div>
                    <div class="mt-5 pt-3 border-t border-gray-100 space-y-2 text-sm">
                        <div class="flex items-center gap-2"><i class="fas fa-phone-alt text-gray-400 w-3"></i><a href="tel:${p.Phone}" class="text-thuBlue font-medium hover:underline">${p.Phone}</a></div>
                        <div class="flex items-center gap-2"><i class="fas fa-envelope text-gray-400 w-3"></i><a href="mailto:${p.Email}" class="text-thuBlue font-medium hover:underline truncate">${p.Email}</a></div>
                    </div>
                </div>`;
            });
            staffHtml += '</div>'; container.innerHTML += staffHtml;
        }

        function toggleModal(id) {
            const m = document.getElementById(id); m.classList.toggle('opacity-0'); m.classList.toggle('pointer-events-none'); document.querySelector('body').classList.toggle('modal-active');
        }
        document.onkeydown = function(evt) { if((evt.key==="Escape"||evt.keyCode===27)&&document.body.classList.contains('modal-active')) document.querySelectorAll('.modal:not(.opacity-0)').forEach(m=>toggleModal(m.id)); };
        window.addEventListener('scroll', () => { 
            const h=document.getElementById('sticky-header'); 
            const b=document.getElementById('preview-banner');
            let offset = 0;
            if (b && !b.classList.contains('hidden')) offset = b.offsetHeight; // 如果有 banner，header 要往下移

            if(window.scrollY>200){
                h.classList.remove('-translate-y-full','opacity-0'); h.classList.add('translate-y-0','opacity-100');
                h.style.top = offset + 'px'; // 調整位置
            } else {
                h.classList.add('-translate-y-full','opacity-0'); h.classList.remove('translate-y-0','opacity-100');
            }
        });
    </script>
</body>
</html>
