<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>實習相關法規 | 東海大學實習中心</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: { colors: { thuBlue: '#002E5D', thuLightBlue: '#eef6fc', thuGold: '#C6A87C', pdfRed: '#dc2626' }, fontFamily: { sans: ['"Noto Sans TC"', 'sans-serif'] } }
            }
        }
    </script>
    <style>
        .page-header { background: linear-gradient(135deg, #002E5D 0%, #001a35 100%); position: relative; overflow: hidden; }
        .page-header::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px); background-size: 30px 30px; opacity: 0.3; }
        .download-btn { background-color: #dc2626; color: white; padding: 6px 12px; border-radius: 4px; font-size: 0.8rem; font-weight: 500; display: inline-flex; align-items: center; gap: 6px; transition: all 0.2s; white-space: nowrap; }
        .download-btn:hover { background-color: #b91c1c; transform: translateY(-1px); box-shadow: 0 2px 4px rgba(0,0,0,0.15); }
        .filter-btn { transition: all 0.2s; }
        .filter-btn:hover:not(.active) { border-color: #002E5D; color: #002E5D; }
        .filter-btn.active { background-color: #002E5D; color: white; border-color: transparent; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .issuer-tag { background-color: #eef6fc; color: #002E5D; border: 1px solid #d1e5f3; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: 600; display: inline-flex; align-items: center; gap: 4px; }
        #scroll-to-top { position: fixed; bottom: 24px; right: 24px; width: 48px; height: 48px; background-color: #002E5D; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s, transform 0.3s; cursor: pointer; z-index: 1000; }
        #scroll-to-top.show { opacity: 1; visibility: visible; transform: translateY(0); }
        #scroll-to-top:hover { background-color: #001a35; transform: translateY(-2px); }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-700 flex flex-col min-h-screen pb-24">

    <!-- Header -->
    <nav class="bg-thuBlue text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
            <a href="index.html" class="flex items-center gap-3 hover:opacity-90 transition">
                <img src="https://www.thu.edu.tw/upload/pagepic_upload/logo_w.svg" alt="Logo" class="h-8 w-auto">
                <span id="nav-site-title" class="font-bold tracking-wide hidden sm:inline">實習業務協作平台</span>
            </a>
            <a href="index.html" class="text-sm bg-white/10 hover:bg-white/20 px-4 py-1.5 rounded-full transition flex items-center gap-2"><i class="fas fa-arrow-left"></i> 回首頁</a>
        </div>
    </nav>

    <!-- Page Title -->
    <header class="page-header text-white py-12">
        <div class="max-w-5xl mx-auto px-4 text-center relative z-10">
            <div id="header-tag" class="inline-block bg-white/10 backdrop-blur-sm px-4 py-1 rounded-full text-sm text-thuGold mb-3 border border-white/20">Loading...</div>
            <h1 id="header-title" class="text-3xl md:text-4xl font-bold mb-2 tracking-widest">Loading...</h1>
            <p id="header-desc" class="text-gray-400 text-sm">Loading...</p>
        </div>
    </header>

    <!-- Content -->
    <main class="flex-grow max-w-5xl mx-auto px-4 py-12 w-full">
        <!-- 動態產生按鈕 -->
        <div id="filter-container" class="flex flex-wrap justify-center gap-2 mb-10 animate-fade-in-up"></div>
        
        <div id="laws-container" class="space-y-4 min-h-[300px]">
            <div class="text-center py-12 text-gray-400"><i class="fas fa-spinner fa-spin text-2xl mb-2"></i><p>讀取資料中...</p></div>
        </div>
    </main>

    <!-- Footer -->
    <footer id="footer-trigger" style="position: fixed; bottom: 0; left: 0; width: 100%; z-index: 50; background-color: #1f2937; color: #9ca3af; text-align: center; padding: 1rem 0; font-size: 0.75rem; border-top: 3px solid #C6A87C;">
        <div class="container mx-auto px-4">
            <div class="flex flex-col items-center justify-center gap-1">
                <p id="footer-copyright" class="font-bold text-white tracking-wide text-[10px]"></p>
                <p class="text-[9px] text-gray-500">網頁製作：張博堯 | Assisted by Google Gemini | <a href="admin.html" target="_blank" class="hover:text-white">後台管理</a></p>
            </div>
        </div>
    </footer>
    <button id="scroll-to-top" onclick="window.scrollTo({top:0, behavior:'smooth'})"><i class="fas fa-chevron-up"></i></button>

    <script>
        let allLaws = [];
        let categories = [];
        let fileFieldsConfig = [];
        
        document.addEventListener('scroll', () => { const btn = document.getElementById('scroll-to-top'); if(window.scrollY>300) btn.classList.add('show'); else btn.classList.remove('show'); });

        document.addEventListener('DOMContentLoaded', async function() {
            try {
                const response = await fetch(`data.json?t=${new Date().getTime()}`);
                if (!response.ok) throw new Error("Load failed");
                const data = await response.json();

                if (data.settings) {
                    document.getElementById('nav-site-title').innerText = data.settings.SiteTitle || '實習業務協作平台';
                    document.getElementById('footer-copyright').innerText = data.settings.Copyright;
                }

                const pageInfo = data.pages['laws'];
                if(pageInfo) {
                    document.title = `${pageInfo.title} | ${data.settings.SiteTitle}`;
                    document.getElementById('header-tag').innerText = pageInfo.tag || 'Regulations';
                    document.getElementById('header-title').innerText = pageInfo.title;
                    document.getElementById('header-desc').innerText = pageInfo.description || '';
                    
                    // Get Categories (Default fallback)
                    categories = pageInfo.categories || [
                        { id: 'edu', name: '教育部法規' },
                        { id: 'admin', name: '行政函釋' },
                        { id: 'school', name: '校內法規' }
                    ];
                    
                    // Get File Fields Config
                    fileFieldsConfig = pageInfo.fileFields || [
                        { key: 'url_1', label: '中文版', icon: 'fa-file-pdf' },
                        { key: 'url_2', label: '英文版', icon: 'fa-file-pdf' },
                        { key: 'url_3', label: '附件一', icon: 'fa-paperclip' },
                        { key: 'url_4', label: '附件二', icon: 'fa-paperclip' },
                        { key: 'url_5', label: '相關連結', icon: 'fa-link' }
                    ];

                    allLaws = pageInfo.items;
                    
                    renderFilterButtons();
                    renderLaws(allLaws);
                }
            } catch (error) {
                console.error(error);
                document.getElementById('laws-container').innerHTML = `<div class="text-center text-red-500 py-10">資料讀取錯誤</div>`;
            }
        });

        function renderFilterButtons() {
            const container = document.getElementById('filter-container');
            container.innerHTML = `<button onclick="filterLaws('all')" class="filter-btn active px-5 py-2 rounded-full text-sm font-bold border border-transparent bg-thuBlue text-white" id="btn-all">全部顯示</button>`;
            
            categories.forEach(cat => {
                container.innerHTML += `<button onclick="filterLaws('${cat.id}')" class="filter-btn px-5 py-2 rounded-full text-sm font-medium border border-gray-300 bg-white text-gray-600" id="btn-${cat.id}">${cat.name}</button>`;
            });
        }

        function filterLaws(category) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active', 'bg-thuBlue', 'text-white'));
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.add('bg-white', 'text-gray-600', 'border-gray-300'));
            
            const activeBtn = document.getElementById(`btn-${category}`);
            activeBtn.classList.remove('bg-white', 'text-gray-600', 'border-gray-300');
            activeBtn.classList.add('active', 'bg-thuBlue', 'text-white', 'border-transparent');
            
            const filtered = category === 'all' ? allLaws : allLaws.filter(item => item.category === category);
            renderLaws(filtered);
        }

        function renderLaws(items) {
            const container = document.getElementById('laws-container');
            container.innerHTML = '';
            
            // Filter visible items
            const visibleItems = items.filter(i => i.visible !== false);

            if (!visibleItems || visibleItems.length === 0) { 
                container.innerHTML = '<div class="text-center py-12 text-gray-400 bg-white rounded-xl border border-dashed border-gray-300">沒有符合條件的法規</div>'; 
                return; 
            }

            visibleItems.forEach(item => {
                let btns = '';
                
                // Backward compatibility
                if (item.url_zh && !item.url_1) {
                    btns += `<a href="${item.url_zh}" target="_blank" class="download-btn"><i class="fas fa-file-pdf"></i> 中文版</a>`;
                }
                if (item.url_en && !item.url_2) {
                    btns += `<a href="${item.url_en}" target="_blank" class="download-btn"><i class="fas fa-file-pdf"></i> 英文版</a>`;
                }
                if (item.url && !item.url_zh && !item.url_en && !item.url_1) {
                    btns += `<a href="${item.url}" target="_blank" class="download-btn"><i class="fas fa-file-pdf"></i> 下載</a>`;
                }

                // New Dynamic Fields Logic
                // Only render if URL exists. We removed "show_" config per request, now purely based on content existence.
                fileFieldsConfig.forEach(field => {
                    const key = field.key;
                    const url = item[key];
                    
                    if (url && url.trim() !== "") {
                        const label = field.label || '檔案下載';
                        const icon = field.icon || 'fa-download';
                        btns += `<a href="${url}" target="_blank" class="download-btn"><i class="fas ${icon}"></i> ${label}</a>`;
                    }
                });

                const formattedDate = item.date ? item.date.replace(/-/g, '/') : '';
                const issuerText = item.issuer || '東海大學';

                container.innerHTML += `
                <div class="group block bg-white border border-gray-200 rounded-lg p-5 transition cursor-default mb-3">
                    <div class="flex flex-col sm:flex-row sm:items-center gap-4">
                        <div class="flex-grow min-w-0">
                            <div class="flex flex-wrap items-center gap-2 mb-2">
                                <span class="issuer-tag">${issuerText}</span>
                                ${formattedDate ? `<span class="text-xs text-gray-500 flex items-center gap-1"><i class="fas fa-calendar-alt"></i> 最新修正日期：${formattedDate}</span>` : ''}
                            </div>
                            <h3 class="text-lg font-bold text-gray-800 transition leading-tight mb-0.5">${item.title}</h3>
                            ${item.title_en ? `<p class="text-xs text-gray-400 font-medium">${item.title_en}</p>` : ''}
                        </div>
                        <div class="flex flex-wrap gap-2 sm:justify-end mt-2 sm:mt-0 flex-shrink-0">${btns}</div>
                    </div>
                </div>`;
            });
        }
    </script>
</body>
</html>
